import json

import wagtail.fields  # type: ignore

from django.db import (
    migrations
)
from django.core.serializers.json import (
    DjangoJSONEncoder
)

import wagtail.blocks  # type: ignore
import wagtail.fields


def convert_to_streamfield(apps, schema_editor):
    BlogPage = apps.get_model("blog", "BlogPostPage")
    for page in BlogPage.objects.all():
        page.body = json.dumps(
            [{
                'type': 'rich_text',
                'value': page.body
            }],
            cls=DjangoJSONEncoder
        )
        page.save()


def convert_to_richtext(apps, schema_editor):
    BlogPage = apps.get_model("blog", "BlogPostPage")
    for page in BlogPage.objects.all():
        if page.body:
            stream = json.loads(page.body)
            page.body = "".join([
                child["value"] for child in stream
                if child["type"] == "rich_text"
            ])
            page.save()


class Migration(migrations.Migration):
    dependencies = [
        ('blog', '0001_initial'),
    ]

    operations = [
        migrations.RunPython(
          convert_to_streamfield,
          convert_to_richtext,
        ),
        migrations.AlterField(
            model_name='blogpostpage',
            name='body',
            field=wagtail.fields.StreamField([('rich_text', 0), ('code', 3)], blank=True, block_lookup={0: ('wagtail.blocks.RichTextBlock', (), {}), 1: ('wagtail.blocks.ChoiceBlock', [], {'choices': [('abap', 'abap'), ('amdgpu', 'amdgpu'), ('apl', 'apl'), ('abnf', 'abnf'), ('actionscript3', 'actionscript3'), ('actionscript', 'actionscript'), ('ada', 'ada'), ('adl', 'adl'), ('agda', 'agda'), ('aheui', 'aheui'), ('alloy', 'alloy'), ('ambienttalk', 'ambienttalk'), ('ampl', 'ampl'), ('html+ng2', 'html+ng2'), ('ng2', 'ng2'), ('antlr-actionscript', 'antlr-actionscript'), ('antlr-csharp', 'antlr-csharp'), ('antlr-cpp', 'antlr-cpp'), ('antlr-java', 'antlr-java'), ('antlr', 'antlr'), ('antlr-objc', 'antlr-objc'), ('antlr-perl', 'antlr-perl'), ('antlr-python', 'antlr-python'), ('antlr-ruby', 'antlr-ruby'), ('apacheconf', 'apacheconf'), ('applescript', 'applescript'), ('arduino', 'arduino'), ('arrow', 'arrow'), ('arturo', 'arturo'), ('asc', 'asc'), ('asn1', 'asn1'), ('aspectj', 'aspectj'), ('asymptote', 'asymptote'), ('augeas', 'augeas'), ('autoit', 'autoit'), ('autohotkey', 'autohotkey'), ('awk', 'awk'), ('bbcbasic', 'bbcbasic'), ('bbcode', 'bbcode'), ('bc', 'bc'), ('bqn', 'bqn'), ('bst', 'bst'), ('bare', 'bare'), ('basemake', 'basemake'), ('bash', 'bash'), ('console', 'console'), ('batch', 'batch'), ('bdd', 'bdd'), ('befunge', 'befunge'), ('berry', 'berry'), ('bibtex', 'bibtex'), ('blitzbasic', 'blitzbasic'), ('blitzmax', 'blitzmax'), ('blueprint', 'blueprint'), ('bnf', 'bnf'), ('boa', 'boa'), ('boo', 'boo'), ('boogie', 'boogie'), ('brainfuck', 'brainfuck'), ('bugs', 'bugs'), ('camkes', 'camkes'), ('c', 'c'), ('cmake', 'cmake'), ('c-objdump', 'c-objdump'), ('cpsa', 'cpsa'), ('css+ul4', 'css+ul4'), ('aspx-cs', 'aspx-cs'), ('csharp', 'csharp'), ('ca65', 'ca65'), ('cadl', 'cadl'), ('capdl', 'capdl'), ('capnp', 'capnp'), ('carbon', 'carbon'), ('cbmbas', 'cbmbas'), ('cddl', 'cddl'), ('ceylon', 'ceylon'), ('cfengine3', 'cfengine3'), ('chaiscript', 'chaiscript'), ('chapel', 'chapel'), ('charmci', 'charmci'), ('html+cheetah', 'html+cheetah'), ('javascript+cheetah', 'javascript+cheetah'), ('cheetah', 'cheetah'), ('xml+cheetah', 'xml+cheetah'), ('cirru', 'cirru'), ('clay', 'clay'), ('clean', 'clean'), ('clojure', 'clojure'), ('clojurescript', 'clojurescript'), ('cobolfree', 'cobolfree'), ('cobol', 'cobol'), ('coffeescript', 'coffeescript'), ('cfc', 'cfc'), ('cfm', 'cfm'), ('cfs', 'cfs'), ('comal', 'comal'), ('common-lisp', 'common-lisp'), ('componentpascal', 'componentpascal'), ('coq', 'coq'), ('cplint', 'cplint'), ('cpp', 'cpp'), ('cpp-objdump', 'cpp-objdump'), ('crmsh', 'crmsh'), ('croc', 'croc'), ('cryptol', 'cryptol'), ('cr', 'cr'), ('csound-document', 'csound-document'), ('csound', 'csound'), ('csound-score', 'csound-score'), ('css+django', 'css+django'), ('css+ruby', 'css+ruby'), ('css+genshitext', 'css+genshitext'), ('css', 'css'), ('css+php', 'css+php'), ('css+smarty', 'css+smarty'), ('cuda', 'cuda'), ('cypher', 'cypher'), ('cython', 'cython'), ('d', 'd'), ('d-objdump', 'd-objdump'), ('dpatch', 'dpatch'), ('dart', 'dart'), ('dasm16', 'dasm16'), ('dax', 'dax'), ('debcontrol', 'debcontrol'), ('delphi', 'delphi'), ('desktop', 'desktop'), ('devicetree', 'devicetree'), ('dg', 'dg'), ('diff', 'diff'), ('django', 'django'), ('zone', 'zone'), ('docker', 'docker'), ('dtd', 'dtd'), ('duel', 'duel'), ('dylan-console', 'dylan-console'), ('dylan', 'dylan'), ('dylan-lid', 'dylan-lid'), ('ecl', 'ecl'), ('ec', 'ec'), ('earl-grey', 'earl-grey'), ('easytrieve', 'easytrieve'), ('ebnf', 'ebnf'), ('eiffel', 'eiffel'), ('iex', 'iex'), ('elixir', 'elixir'), ('elm', 'elm'), ('elpi', 'elpi'), ('emacs-lisp', 'emacs-lisp'), ('email', 'email'), ('erb', 'erb'), ('erlang', 'erlang'), ('erl', 'erl'), ('html+evoque', 'html+evoque'), ('evoque', 'evoque'), ('xml+evoque', 'xml+evoque'), ('execline', 'execline'), ('ezhil', 'ezhil'), ('fsharp', 'fsharp'), ('fstar', 'fstar'), ('factor', 'factor'), ('fancy', 'fancy'), ('fan', 'fan'), ('felix', 'felix'), ('fennel', 'fennel'), ('fift', 'fift'), ('fish', 'fish'), ('flatline', 'flatline'), ('floscript', 'floscript'), ('forth', 'forth'), ('fortranfixed', 'fortranfixed'), ('fortran', 'fortran'), ('foxpro', 'foxpro'), ('freefem', 'freefem'), ('func', 'func'), ('futhark', 'futhark'), ('gap-console', 'gap-console'), ('gap', 'gap'), ('gdscript', 'gdscript'), ('glsl', 'glsl'), ('gsql', 'gsql'), ('gas', 'gas'), ('gcode', 'gcode'), ('genshi', 'genshi'), ('genshitext', 'genshitext'), ('pot', 'pot'), ('gherkin', 'gherkin'), ('gnuplot', 'gnuplot'), ('go', 'go'), ('golo', 'golo'), ('gooddata-cl', 'gooddata-cl'), ('gosu', 'gosu'), ('gst', 'gst'), ('graphql', 'graphql'), ('graphviz', 'graphviz'), ('groff', 'groff'), ('groovy', 'groovy'), ('hlsl', 'hlsl'), ('html+ul4', 'html+ul4'), ('haml', 'haml'), ('html+handlebars', 'html+handlebars'), ('handlebars', 'handlebars'), ('haskell', 'haskell'), ('haxe', 'haxe'), ('hexdump', 'hexdump'), ('hsail', 'hsail'), ('hspec', 'hspec'), ('html+django', 'html+django'), ('html+genshi', 'html+genshi'), ('html', 'html'), ('html+php', 'html+php'), ('html+smarty', 'html+smarty'), ('http', 'http'), ('haxeml', 'haxeml'), ('hylang', 'hylang'), ('hybris', 'hybris'), ('idl', 'idl'), ('icon', 'icon'), ('idris', 'idris'), ('igor', 'igor'), ('inform6', 'inform6'), ('i6t', 'i6t'), ('inform7', 'inform7'), ('ini', 'ini'), ('io', 'io'), ('ioke', 'ioke'), ('irc', 'irc'), ('isabelle', 'isabelle'), ('j', 'j'), ('jmespath', 'jmespath'), ('jslt', 'jslt'), ('jags', 'jags'), ('janet', 'janet'), ('jasmin', 'jasmin'), ('java', 'java'), ('javascript+django', 'javascript+django'), ('javascript+ruby', 'javascript+ruby'), ('js+genshitext', 'js+genshitext'), ('javascript', 'javascript'), ('javascript+php', 'javascript+php'), ('javascript+smarty', 'javascript+smarty'), ('js+ul4', 'js+ul4'), ('jcl', 'jcl'), ('jsgf', 'jsgf'), ('jsonld', 'jsonld'), ('json', 'json'), ('jsonnet', 'jsonnet'), ('jsp', 'jsp'), ('jsx', 'jsx'), ('jlcon', 'jlcon'), ('julia', 'julia'), ('juttle', 'juttle'), ('k', 'k'), ('kal', 'kal'), ('kconfig', 'kconfig'), ('kmsg', 'kmsg'), ('koka', 'koka'), ('kotlin', 'kotlin'), ('kuin', 'kuin'), ('kql', 'kql'), ('lsl', 'lsl'), ('css+lasso', 'css+lasso'), ('html+lasso', 'html+lasso'), ('javascript+lasso', 'javascript+lasso'), ('lasso', 'lasso'), ('xml+lasso', 'xml+lasso'), ('ldapconf', 'ldapconf'), ('ldif', 'ldif'), ('lean', 'lean'), ('lean4', 'lean4'), ('less', 'less'), ('lighttpd', 'lighttpd'), ('lilypond', 'lilypond'), ('limbo', 'limbo'), ('liquid', 'liquid'), ('literate-agda', 'literate-agda'), ('literate-cryptol', 'literate-cryptol'), ('literate-haskell', 'literate-haskell'), ('literate-idris', 'literate-idris'), ('livescript', 'livescript'), ('llvm', 'llvm'), ('llvm-mir-body', 'llvm-mir-body'), ('llvm-mir', 'llvm-mir'), ('logos', 'logos'), ('logtalk', 'logtalk'), ('lua', 'lua'), ('luau', 'luau'), ('mcfunction', 'mcfunction'), ('mcschema', 'mcschema'), ('mime', 'mime'), ('mips', 'mips'), ('moocode', 'moocode'), ('doscon', 'doscon'), ('macaulay2', 'macaulay2'), ('make', 'make'), ('css+mako', 'css+mako'), ('html+mako', 'html+mako'), ('javascript+mako', 'javascript+mako'), ('mako', 'mako'), ('xml+mako', 'xml+mako'), ('maql', 'maql'), ('markdown', 'markdown'), ('mask', 'mask'), ('mason', 'mason'), ('mathematica', 'mathematica'), ('matlab', 'matlab'), ('matlabsession', 'matlabsession'), ('maxima', 'maxima'), ('meson', 'meson'), ('minid', 'minid'), ('miniscript', 'miniscript'), ('modelica', 'modelica'), ('modula2', 'modula2'), ('trac-wiki', 'trac-wiki'), ('mojo', 'mojo'), ('monkey', 'monkey'), ('monte', 'monte'), ('moonscript', 'moonscript'), ('mosel', 'mosel'), ('css+mozpreproc', 'css+mozpreproc'), ('mozhashpreproc', 'mozhashpreproc'), ('javascript+mozpreproc', 'javascript+mozpreproc'), ('mozpercentpreproc', 'mozpercentpreproc'), ('xul+mozpreproc', 'xul+mozpreproc'), ('mql', 'mql'), ('mscgen', 'mscgen'), ('mupad', 'mupad'), ('mxml', 'mxml'), ('mysql', 'mysql'), ('css+myghty', 'css+myghty'), ('html+myghty', 'html+myghty'), ('javascript+myghty', 'javascript+myghty'), ('myghty', 'myghty'), ('xml+myghty', 'xml+myghty'), ('ncl', 'ncl'), ('nsis', 'nsis'), ('nasm', 'nasm'), ('objdump-nasm', 'objdump-nasm'), ('nemerle', 'nemerle'), ('nesc', 'nesc'), ('nestedtext', 'nestedtext'), ('newlisp', 'newlisp'), ('newspeak', 'newspeak'), ('nginx', 'nginx'), ('nimrod', 'nimrod'), ('nit', 'nit'), ('nixos', 'nixos'), ('nodejsrepl', 'nodejsrepl'), ('notmuch', 'notmuch'), ('nusmv', 'nusmv'), ('numpy', 'numpy'), ('objdump', 'objdump'), ('objective-c', 'objective-c'), ('objective-c++', 'objective-c++'), ('objective-j', 'objective-j'), ('ocaml', 'ocaml'), ('octave', 'octave'), ('odin', 'odin'), ('omg-idl', 'omg-idl'), ('ooc', 'ooc'), ('opa', 'opa'), ('openedge', 'openedge'), ('openscad', 'openscad'), ('org', 'org'), ('output', 'output'), ('pacmanconf', 'pacmanconf'), ('pan', 'pan'), ('parasail', 'parasail'), ('pawn', 'pawn'), ('peg', 'peg'), ('perl6', 'perl6'), ('perl', 'perl'), ('phix', 'phix'), ('php', 'php'), ('pig', 'pig'), ('pike', 'pike'), ('pkgconfig', 'pkgconfig'), ('plpgsql', 'plpgsql'), ('pointless', 'pointless'), ('pony', 'pony'), ('portugol', 'portugol'), ('postscript', 'postscript'), ('psql', 'psql'), ('postgres-explain', 'postgres-explain'), ('postgresql', 'postgresql'), ('pov', 'pov'), ('powershell', 'powershell'), ('pwsh-session', 'pwsh-session'), ('praat', 'praat'), ('procfile', 'procfile'), ('prolog', 'prolog'), ('promql', 'promql'), ('promela', 'promela'), ('properties', 'properties'), ('protobuf', 'protobuf'), ('prql', 'prql'), ('psysh', 'psysh'), ('ptx', 'ptx'), ('pug', 'pug'), ('puppet', 'puppet'), ('pypylog', 'pypylog'), ('python2', 'python2'), ('py2tb', 'py2tb'), ('pycon', 'pycon'), ('python', 'python'), ('pytb', 'pytb'), ('py+ul4', 'py+ul4'), ('qbasic', 'qbasic'), ('q', 'q'), ('qvto', 'qvto'), ('qlik', 'qlik'), ('qml', 'qml'), ('rconsole', 'rconsole'), ('rng-compact', 'rng-compact'), ('spec', 'spec'), ('racket', 'racket'), ('ragel-c', 'ragel-c'), ('ragel-cpp', 'ragel-cpp'), ('ragel-d', 'ragel-d'), ('ragel-em', 'ragel-em'), ('ragel-java', 'ragel-java'), ('ragel', 'ragel'), ('ragel-objc', 'ragel-objc'), ('ragel-ruby', 'ragel-ruby'), ('rd', 'rd'), ('reasonml', 'reasonml'), ('rebol', 'rebol'), ('red', 'red'), ('redcode', 'redcode'), ('registry', 'registry'), ('resourcebundle', 'resourcebundle'), ('rexx', 'rexx'), ('rhtml', 'rhtml'), ('ride', 'ride'), ('rita', 'rita'), ('roboconf-graph', 'roboconf-graph'), ('roboconf-instances', 'roboconf-instances'), ('robotframework', 'robotframework'), ('rql', 'rql'), ('rsl', 'rsl'), ('restructuredtext', 'restructuredtext'), ('trafficscript', 'trafficscript'), ('rbcon', 'rbcon'), ('ruby', 'ruby'), ('rust', 'rust'), ('sas', 'sas'), ('splus', 'splus'), ('sml', 'sml'), ('snbt', 'snbt'), ('sarl', 'sarl'), ('sass', 'sass'), ('savi', 'savi'), ('scala', 'scala'), ('scaml', 'scaml'), ('scdoc', 'scdoc'), ('scheme', 'scheme'), ('scilab', 'scilab'), ('scss', 'scss'), ('sed', 'sed'), ('shexc', 'shexc'), ('shen', 'shen'), ('sieve', 'sieve'), ('silver', 'silver'), ('singularity', 'singularity'), ('slash', 'slash'), ('slim', 'slim'), ('slurm', 'slurm'), ('smali', 'smali'), ('smalltalk', 'smalltalk'), ('sgf', 'sgf'), ('smarty', 'smarty'), ('smithy', 'smithy'), ('snobol', 'snobol'), ('snowball', 'snowball'), ('solidity', 'solidity'), ('androidbp', 'androidbp'), ('sophia', 'sophia'), ('sp', 'sp'), ('debsources', 'debsources'), ('sparql', 'sparql'), ('spice', 'spice'), ('sql+jinja', 'sql+jinja'), ('sql', 'sql'), ('sqlite3', 'sqlite3'), ('squidconf', 'squidconf'), ('srcinfo', 'srcinfo'), ('ssp', 'ssp'), ('stan', 'stan'), ('stata', 'stata'), ('supercollider', 'supercollider'), ('swift', 'swift'), ('swig', 'swig'), ('systemverilog', 'systemverilog'), ('systemd', 'systemd'), ('tap', 'tap'), ('tnt', 'tnt'), ('toml', 'toml'), ('tact', 'tact'), ('tads3', 'tads3'), ('tal', 'tal'), ('tasm', 'tasm'), ('tcl', 'tcl'), ('tcsh', 'tcsh'), ('tcshcon', 'tcshcon'), ('tea', 'tea'), ('teal', 'teal'), ('teratermmacro', 'teratermmacro'), ('termcap', 'termcap'), ('terminfo', 'terminfo'), ('terraform', 'terraform'), ('tex', 'tex'), ('text', 'text'), ('ti', 'ti'), ('thrift', 'thrift'), ('tid', 'tid'), ('tlb', 'tlb'), ('tls', 'tls'), ('todotxt', 'todotxt'), ('tsql', 'tsql'), ('treetop', 'treetop'), ('turtle', 'turtle'), ('html+twig', 'html+twig'), ('twig', 'twig'), ('typescript', 'typescript'), ('typoscriptcssdata', 'typoscriptcssdata'), ('typoscripthtmldata', 'typoscripthtmldata'), ('typoscript', 'typoscript'), ('typst', 'typst'), ('ul4', 'ul4'), ('ucode', 'ucode'), ('unicon', 'unicon'), ('unixconfig', 'unixconfig'), ('urbiscript', 'urbiscript'), ('urlencoded', 'urlencoded'), ('usd', 'usd'), ('vbscript', 'vbscript'), ('vcl', 'vcl'), ('vclsnippets', 'vclsnippets'), ('vctreestatus', 'vctreestatus'), ('vgl', 'vgl'), ('vala', 'vala'), ('aspx-vb', 'aspx-vb'), ('vb.net', 'vb.net'), ('html+velocity', 'html+velocity'), ('velocity', 'velocity'), ('xml+velocity', 'xml+velocity'), ('verifpal', 'verifpal'), ('verilog', 'verilog'), ('vhdl', 'vhdl'), ('vim', 'vim'), ('visualprologgrammar', 'visualprologgrammar'), ('visualprolog', 'visualprolog'), ('vyper', 'vyper'), ('wdiff', 'wdiff'), ('wast', 'wast'), ('webidl', 'webidl'), ('wgsl', 'wgsl'), ('whiley', 'whiley'), ('wikitext', 'wikitext'), ('wowtoc', 'wowtoc'), ('wren', 'wren'), ('x10', 'x10'), ('xml+ul4', 'xml+ul4'), ('xquery', 'xquery'), ('xml+django', 'xml+django'), ('xml+ruby', 'xml+ruby'), ('xml', 'xml'), ('xml+php', 'xml+php'), ('xml+smarty', 'xml+smarty'), ('xorg.conf', 'xorg.conf'), ('xpp', 'xpp'), ('xslt', 'xslt'), ('xtend', 'xtend'), ('extempore', 'extempore'), ('yaml+jinja', 'yaml+jinja'), ('yaml', 'yaml'), ('yang', 'yang'), ('yara', 'yara'), ('zeek', 'zeek'), ('zephir', 'zephir'), ('zig', 'zig'), ('ansys', 'ansys')]}), 2: ('wagtail.blocks.TextBlock', (), {'form_classname': 'monospace'}), 3: ('wagtail.blocks.StructBlock', [[('language', 1), ('code', 2)]], {})}),  # noqa: E501
        ),
    ]
